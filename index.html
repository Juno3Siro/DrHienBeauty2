<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nh√† N·∫•m Nem - N·∫•m H·ªØu C∆° T·ª± Nhi√™n</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>

    <header id="site-header">
        <div class="wrap header-row">
            <a href="#" class="brand logo-text"><span class="gold">Nh√†</span>N·∫•m Nem</a>
            <nav class="nav">
                <a href="#" class="active">Trang Ch·ªß</a>
                <a href="#products">S·∫£n Ph·∫©m</a>
                <a href="#contact">Li√™n H·ªá</a>
                <a href="#" id="cart-icon" aria-label="Gi·ªè h√†ng">
                    üõí <span id="cart-count">0</span>
                </a>
            </nav>
            <button class="menu-btn" aria-label="Open Menu">‚ò∞</button>
        </div>
    </header>

    <nav class="mobile-nav">
        <a href="#">Trang Ch·ªß</a>
        <a href="#products">S·∫£n Ph·∫©m</a>
        <a href="#contact">Li√™n H·ªá</a>
    </nav>

    <main>
        <section class="hero">
            <div class="hero-inner">
                <h1 class="hero-title">S·∫°ch L√†nh T·ª± Nhi√™n, Chu·∫©n Ngon V·ªã Vi·ªát</h1>
                <p class="hero-sub">N·∫•m h·ªØu c∆° ƒë∆∞·ª£c nu√¥i tr·ªìng v·ªõi t√¢m huy·∫øt, mang ƒë·∫øn nh·ªØng b·ªØa ƒÉn b·ªï d∆∞·ª°ng cho gia ƒë√¨nh b·∫°n.</p>
                <div class="hero-cta">
                    <a href="#products" class="btn primary">Xem S·∫£n Ph·∫©m</a>
                    <a href="#" class="btn ghost">C√¢u Chuy·ªán C·ªßa N·∫•m</a>
                </div>
            </div>
        </section>

        <section id="products" class="section bg-soft">
            <div class="wrap">
                <div class="section-head">
                    <h2>S·∫£n Ph·∫©m N·ªïi B·∫≠t</h2>
                    <p>Nh·ªØng s·∫£n ph·∫©m tinh t√∫y t·ª´ trang tr·∫°i n·∫•m h·ªØu c∆° c·ªßa Nh√† N·∫•m Nem.</p>
                </div>
                <div class="cards" id="product-list">
                    <!-- Products will be dynamically loaded here -->
                </div>
            </div>
        </section>

        <section id="contact" class="section">
            <div class="wrap">
                 <div class="section-head">
                    <h2>Li√™n H·ªá & ƒê·∫∑t H√†ng</h2>
                </div>
                <div class="contact-grid">
                    <div class="contact-info">
                        <h3>Gh√© thƒÉm ch√∫ng t√¥i</h3>
                        <p>Trang tr·∫°i: Th√¥n ABC, X√£ XYZ, ƒê√† L·∫°t, L√¢m ƒê·ªìng</p>
                        <p>Email: info@nhanamnem.vn</p>
                        <p>Hotline: 0912 345 678</p>
                        <div class="socials">
                            <a href="#">f</a> <a href="#">i</a> <a href="#">z</a>
                        </div>
                    </div>
                    <form class="contact-form">
                        <h3>G·ª≠i tin nh·∫Øn cho ch√∫ng t√¥i</h3>
                        <input type="text" placeholder="H·ªç t√™n" required>
                        <input type="email" placeholder="Email" required>
                        <textarea rows="5" placeholder="N·ªôi dung tin nh·∫Øn"></textarea>
                        <button type="submit" class="btn primary">G·ª≠i ƒëi</button>
                    </form>
                </div>
            </div>
        </section>
    </main>

    <footer class="site-footer">
        <div class="wrap footer-row">
            <a href="#" class="brand small">¬© 2025 Nh√† N·∫•m Nem</a>
            <nav class="nav">
                <a href="#">Ch√≠nh s√°ch</a>
                <a href="#">ƒêi·ªÅu kho·∫£n</a>
            </nav>
        </div>
    </footer>

    <!-- Product Detail Modal -->
    <div id="product-detail-modal" class="product-modal-overlay" style="display: none;">
        <div class="product-modal-content">
            <button id="close-product-modal-btn" class="close-modal-btn" aria-label="Close product details">√ó</button>
            <div class="product-modal-body">
                <div class="product-modal-gallery">
                    <div class="main-image-container">
                        <img id="product-modal-image" src="" alt="Product image">
                        <button class="gallery-nav prev" id="gallery-prev-btn">‚Äπ</button>
                        <button class="gallery-nav next" id="gallery-next-btn">‚Ä∫</button>
                    </div>
                    <div class="thumbnail-container" id="product-modal-thumbnails">
                        <!-- Thumbnails will be injected here -->
                    </div>
                </div>
                <div class="product-modal-details">
                    <h2 id="product-modal-name"></h2>
                    <p id="product-modal-description"></p>
                    <p><strong>Gi√°: <span id="product-modal-price"></span>ƒë</strong></p>
                    <button class="btn primary add-to-cart">Th√™m v√†o gi·ªè</button>
                </div>
            </div>
        </div>
    </div>


    <!-- Cart Modal using a simple div for more control -->
    <div id="cart-modal" class="cart-modal-overlay" style="display: none;">
      <div class="cart-modal-content">
        <header class="cart-modal-header">
          <h2>Gi·ªè h√†ng c·ªßa b·∫°n</h2>
          <button id="close-modal-btn" class="close-modal-btn" aria-label="Close cart">√ó</button>
        </header>
        <div id="cart-items" class="cart-items-container">
          <!-- Cart items will be injected here -->
        </div>
        <footer class="cart-modal-footer">
          <p class="cart-total"><strong>T·ªïng c·ªông: <span id="cart-total">0</span>ƒë</strong></p>
          <button id="checkout-btn" class="btn primary">Thanh to√°n</button>
        </footer>
      </div>
    </div>

    <!-- Checkout Modal -->
    <div id="checkout-modal" class="cart-modal-overlay" style="display: none;">
      <div class="cart-modal-content">
        <header class="cart-modal-header">
          <h2>Th√¥ng tin giao h√†ng</h2>
          <button id="close-checkout-modal-btn" class="close-modal-btn" aria-label="Close checkout">√ó</button>
        </header>
        <form id="checkout-form">
            <div class="form-group">
                <label for="customer-name">H·ªç v√† t√™n</label>
                <input type="text" id="customer-name" required>
            </div>
            <div class="form-group">
                <label for="customer-phone">S·ªë ƒëi·ªán tho·∫°i</label>
                <input type="tel" id="customer-phone" required>
            </div>
            <div class="form-group">
                <label for="customer-address">ƒê·ªãa ch·ªâ</label>
                <input type="text" id="customer-address" required>
            </div>
            <div class="form-group">
                <label for="delivery-time">Th·ªùi gian giao h√†ng</label>
                <input type="text" id="delivery-time" placeholder="C√†ng s·ªõm c√†ng t·ªët, ho·∫∑c ghi r√µ gi·ªù">
            </div>
             <div class="form-group">
                <label for="customer-notes">Ghi ch√∫</label>
                <textarea id="customer-notes" rows="3"></textarea>
            </div>
            <footer class="cart-modal-footer">
                <button type="submit" class="btn primary">X√°c nh·∫≠n ƒë∆°n h√†ng</button>
            </footer>
        </form>
      </div>
    </div>

    <script src="products.js"></script>
    <script src="cart.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const productList = document.getElementById('product-list');
            const heroSection = document.querySelector('.hero');

            // Set hero banner
            if (heroSection && typeof bannerImage !== 'undefined') {
                heroSection.style.backgroundImage = `url('${bannerImage}')`;
            }

            // --- Delegated Image Zoom Logic ---
            function moveLens(e) {
                const lens = e.currentTarget.querySelector('.img-zoom-lens');
                const result = e.currentTarget.parentElement.querySelector('.img-zoom-result');
                const img = e.currentTarget.querySelector('img');
                if (!lens || !result || !img) return;

                e.preventDefault();
                
                const pos = getCursorPos(e, img);
                let x = pos.x - (lens.offsetWidth / 2);
                let y = pos.y - (lens.offsetHeight / 2);

                if (x > img.width - lens.offsetWidth) { x = img.width - lens.offsetWidth; }
                if (x < 0) { x = 0; }
                if (y > img.height - lens.offsetHeight) { y = img.height - lens.offsetHeight; }
                if (y < 0) { y = 0; }

                lens.style.left = x + "px";
                lens.style.top = y + "px";

                const cx = result.offsetWidth / lens.offsetWidth;
                const cy = result.offsetHeight / lens.offsetHeight;
                result.style.backgroundPosition = `-${x * cx}px -${y * cy}px`;
            }

            function getCursorPos(e, img) {
                const a = img.getBoundingClientRect();
                const x = e.pageX - a.left - window.pageXOffset;
                const y = e.pageY - a.top - window.pageYOffset;
                return { x, y };
            }

            productList.addEventListener('mouseover', (e) => {
                if (window.innerWidth < 1024) return; // Only on desktop
                const cardMedia = e.target.closest('.card-media');
                if (!cardMedia) return;

                // Avoid re-creating elements if they exist
                let result = cardMedia.parentElement.querySelector('.img-zoom-result');
                if (!result) {
                    result = document.createElement("DIV");
                    result.setAttribute("class", "img-zoom-result");
                    cardMedia.parentElement.appendChild(result);
                }

                let lens = cardMedia.querySelector('.img-zoom-lens');
                if (!lens) {
                    lens = document.createElement("DIV");
                    lens.setAttribute("class", "img-zoom-lens");
                    cardMedia.insertBefore(lens, cardMedia.firstChild);
                }
                
                const img = cardMedia.querySelector('img');
                result.style.display = 'block';
                lens.style.display = 'block';
                
                result.style.backgroundImage = `url('${img.src}')`;
                const cx = result.offsetWidth / lens.offsetWidth;
                const cy = result.offsetHeight / lens.offsetHeight;
                result.style.backgroundSize = `${img.width * cx}px ${img.height * cy}px`;

                cardMedia.addEventListener('mousemove', moveLens);
            });

            productList.addEventListener('mouseout', (e) => {
                if (window.innerWidth < 1024) return;
                const cardMedia = e.target.closest('.card-media');
                if (!cardMedia) return;

                const result = cardMedia.parentElement.querySelector('.img-zoom-result');
                const lens = cardMedia.querySelector('.img-zoom-lens');

                if (result) result.style.display = 'none';
                if (lens) lens.style.display = 'none';
                
                cardMedia.removeEventListener('mousemove', moveLens);
            });


            // Render product cards
            if (productList && typeof products !== 'undefined') {
                products.forEach(product => {
                    const card = document.createElement('article');
                    // Add 'view-details' to the main card element
                    card.className = 'card view-details'; 
                    card.dataset.id = product.id;
                    card.dataset.name = product.name;
                    card.dataset.price = product.price;
                    card.dataset.productId = product.id;

                    // Use the first image for the card
                    const imageUrl = (product.images && product.images.length > 0) ? product.images[0] : 'image/placeholder.jpg';

                    card.innerHTML = `
                        <div class="card-media">
                            <img src="${imageUrl}" alt="${product.name}">
                        </div>
                        <div class="card-body">
                            <h3>${product.name}</h3>
                            <p>${product.description}</p>
                            <p><strong>Gi√°: ${product.price.toLocaleString('vi-VN')}ƒë</strong></p>
                            <button class="btn primary add-to-cart">Th√™m v√†o gi·ªè</button>
                        </div>
                    `;
                    productList.appendChild(card);
                });
            }

            // --- Product Detail Modal Logic ---
            const productModal = document.getElementById('product-detail-modal');
            const closeModalBtn = document.getElementById('close-product-modal-btn');
            const modalImage = document.getElementById('product-modal-image');
            const modalName = document.getElementById('product-modal-name');
            const modalDesc = document.getElementById('product-modal-description');
            const modalPrice = document.getElementById('product-modal-price');
            const modalThumbnails = document.getElementById('product-modal-thumbnails');
            const prevBtn = document.getElementById('gallery-prev-btn');
            const nextBtn = document.getElementById('gallery-next-btn');

            let currentProductImages = [];
            let currentImageIndex = 0;

            const openProductModal = (productId) => {
                const product = products.find(p => p.id === parseInt(productId));
                if (!product || !product.images || product.images.length === 0) return;

                currentProductImages = product.images;
                currentImageIndex = 0;

                modalName.textContent = product.name;
                modalDesc.textContent = product.description;
                modalPrice.textContent = product.price.toLocaleString('vi-VN');
                
                updateModalImage();
                
                modalThumbnails.innerHTML = '';
                if (product.images.length > 1) {
                    product.images.forEach((imgSrc, index) => {
                        const thumb = document.createElement('img');
                        thumb.src = imgSrc;
                        thumb.alt = `Thumbnail ${index + 1}`;
                        thumb.dataset.index = index;
                        modalThumbnails.appendChild(thumb);
                    });
                    modalThumbnails.style.display = 'flex';
                } else {
                    modalThumbnails.style.display = 'none';
                }


                productModal.style.display = 'flex';
            };

            const updateModalImage = () => {
                if (currentProductImages.length === 0) return;
                modalImage.src = currentProductImages[currentImageIndex];
                
                const thumbs = modalThumbnails.querySelectorAll('img');
                thumbs.forEach((thumb, index) => {
                    thumb.classList.toggle('active', index === currentImageIndex);
                });

                prevBtn.style.display = currentProductImages.length > 1 && currentImageIndex > 0 ? 'block' : 'none';
                nextBtn.style.display = currentProductImages.length > 1 && currentImageIndex < currentProductImages.length - 1 ? 'block' : 'none';
            };

            productList.addEventListener('click', (e) => {
                const viewDetailsTrigger = e.target.closest('.view-details');
                // Do not open modal if the click was on a zoom-related element or add-to-cart button
                if (viewDetailsTrigger && !e.target.closest('.img-zoom-lens') && !e.target.closest('.add-to-cart')) {
                    const productId = viewDetailsTrigger.dataset.productId;
                    openProductModal(productId);
                }
            });

            closeModalBtn.addEventListener('click', () => productModal.style.display = 'none');
            productModal.addEventListener('click', (e) => {
                if (e.target === productModal) {
                    productModal.style.display = 'none';
                }
            });

            nextBtn.addEventListener('click', () => {
                if (currentImageIndex < currentProductImages.length - 1) {
                    currentImageIndex++;
                    updateModalImage();
                }
            });

            prevBtn.addEventListener('click', () => {
                if (currentImageIndex > 0) {
                    currentImageIndex--;
                    updateModalImage();
                }
            });

            modalThumbnails.addEventListener('click', (e) => {
                if (e.target.tagName === 'IMG') {
                    currentImageIndex = parseInt(e.target.dataset.index);
                    updateModalImage();
                }
            });


            // --- Mobile Menu Logic ---
            const header = document.getElementById('site-header');
            const menuBtn = document.querySelector('.menu-btn');
            const mobileNav = document.querySelector('.mobile-nav');

            window.addEventListener('scroll', () => {
                if (window.scrollY > 50) {
                    header.classList.add('solid');
                } else {
                    header.classList.remove('solid');
                }
            });

            menuBtn.addEventListener('click', () => {
                mobileNav.classList.toggle('open');
            });
        });
    </script>
</body>
</html>
